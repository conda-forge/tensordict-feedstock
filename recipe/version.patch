From 64a59ed7fdeb12d2c03477ba4ab929971aef165d Mon Sep 17 00:00:00 2001
From: Vincent Moens <vincentmoens@gmail.com>
Date: Tue, 23 Sep 2025 10:59:38 +0100
Subject: [PATCH] good progress

---
 setup.py                  | 41 ++++++++++++++++++++++++++-------------
 version.txt               |  1 +
 2 files changed, 29 insertions(+), 13 deletions(-)
 create mode 100644 version.txt

diff --git a/setup.py b/setup.py
index fa49752f3..aa8df7409 100644
--- a/setup.py
+++ b/setup.py
@@ -3,6 +3,7 @@
 # This source code is licensed under the MIT license found in the
 # LICENSE file in the root directory of this source tree.
 
+import contextlib
 import distutils.command.clean
 import logging
 import os
@@ -90,16 +91,30 @@ def get_extensions():
     extensions_dir = os.path.join(ROOT_DIR, "tensordict", "csrc")
     return [CMakeExtension("tensordict._C", sourcedir=extensions_dir)]
 
-
-setup(
-    ext_modules=get_extensions(),
-    cmdclass={
-        "build_ext": CMakeBuild,
-        "clean": clean,
-    },
-    packages=find_packages(
-        exclude=("test", "tutorials", "packaging", "gallery", "docs")
-    ),
-    setup_requires=["setuptools_scm"],
-    use_scm_version=True,
-)
+@contextlib.contextmanager
+def set_version():
+
+    if "SETUPTOOLS_SCM_PRETEND_VERSION" not in os.environ:
+        # grab version from local version.py
+        sys.path.append(Path(__file__).parent)
+        with open("version.txt", "r") as f:
+            version_str = f.read()
+            os.environ["SETUPTOOLS_SCM_PRETEND_VERSION"] = version_str
+        yield
+        del os.environ["SETUPTOOLS_SCM_PRETEND_VERSION"]
+        return
+    yield
+
+with set_version():
+    setup(
+        ext_modules=get_extensions(),
+        cmdclass={
+            "build_ext": CMakeBuild,
+            "clean": clean,
+        },
+        packages=find_packages(
+            exclude=("test", "tutorials", "packaging", "gallery", "docs")
+        ),
+        setup_requires=["setuptools_scm"],
+        use_scm_version=True,
+    )
diff --git a/version.txt b/version.txt
new file mode 100644
index 000000000..2774f8587
--- /dev/null
+++ b/version.txt
@@ -0,0 +1 @@
+0.10.0
\ No newline at end of file
